import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.metrics.pairwise import cosine_similarity


df = pd.read_excel(r"c:\Users\lipi-\OneDrive\Documents\online retail recommandation system.xlsx")
df.dropna(subset=['CustomerID', 'Description'], inplace=True)
df = df[~df['InvoiceNo'].astype(str).str.startswith('C')]
df['InvoiceDate'] = pd.to_datetime(df['InvoiceDate'])
df['Description'] = df['Description'].str.strip().str.lower()
df['TotalAmount'] = df['Quantity'] * df['UnitPrice']
basket = df.pivot_table(index='CustomerID',
                        columns='Description',
                        values='Quantity',
                        aggfunc='sum',
                        fill_value=0)
item_similarity = cosine_similarity(basket.T)
item_similarity_df = pd.DataFrame(item_similarity, index=basket.columns, columns=basket.columns)
def recommend_items(item_name, n=5):
    item_name = item_name.lower().strip()
    if item_name not in item_similarity_df.columns:
        return f"Item '{item_name}' not found in dataset."
    similar_items = item_similarity_df[item_name].sort_values(ascending=False)[1:n+1]
    return similar_items
def top_products_by_country(country):
    country_df = df[df['Country'].str.lower() == country.lower()]
    top = country_df.groupby('Description')['Quantity'].sum().sort_values(ascending=False).head(10)
    print(f"\nTop 10 Products in {country}:\n{top}")
    plt.figure(figsize=(10, 5))
    sns.barplot(x=top.values, y=top.index, palette='pastel')
    plt.title(f'Top 10 Products in {country}')
    plt.xlabel("Quantity Sold")
    plt.ylabel("Product")
    plt.tight_layout()
    plt.show()

df['Month'] = df['InvoiceDate'].dt.to_period('M')
monthly_top = df.groupby(['Month', 'Description'])['Quantity'].sum().sort_values(ascending=False).groupby('Month').head(5)
print("\nMonthly Top Products:\n", monthly_top)


top_products = df.groupby('Description')['Quantity'].sum().sort_values(ascending=False).head(10)
print("\nTop 10 Products Sold Globally:\n", top_products)

plt.figure(figsize=(10, 5))
sns.barplot(x=top_products.values, y=top_products.index, palette='viridis')
plt.title("Top 10 Products Sold Globally")
plt.xlabel("Total Quantity Sold")
plt.ylabel("Product Description")
plt.tight_layout()
plt.show()


print("\nRecommended products for 'white hanging heart t-light holder':\n")
print(recommend_items("white hanging heart t-light holder", 5))


top_products_by_country("United Kingdom")
